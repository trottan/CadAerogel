#!/usr/bin/perl -w

use strict;
use warnings;
use lib ("$ENV{GEMC}/api/perl");
use utils;
use geometry;
use materials;

# Help Message
sub help()
{
	print "\n Usage: \n";
	print "   materials.pl <configuration filename>\n";
 	print "   Will create rich materials\n";
	exit;
}

# Make sure the argument list is correct
# If not pring the help
if( scalar @ARGV != 1)
{
	help();
	exit;
}


require "./bank.pl";
require "./G4.pl";



# Loading configuration file from  argument
our %configuration = load_configuration($ARGV[0]);



# Table of optical photon energies:
my @penergy = ( "1.3778*eV",  "1.3933*eV", "1.4091*eV", "1.4253*eV",   "1.4419*eV",  #5
		"1.4588*eV",  "1.4762*eV",  "1.4940*eV",  "1.5122*eV",  "1.5309*eV", #10
		"1.5500*eV",  "1.5696*eV",  "1.5897*eV",  "1.6104*eV",  "1.6316*eV", #15
		"1.6533*eV",  "1.6757*eV",  "1.6986*eV",  "1.7222*eV",  "1.7465*eV", #20
		"1.7714*eV",  "1.7971*eV",  "1.8235*eV",  "1.8507*eV",  "1.8788*eV", #25
		"1.9077*eV",  "1.9375*eV",  "1.9683*eV",  "2.0000*eV",  "2.0328*eV", #30
		"2.0667*eV",  "2.1017*eV",  "2.1379*eV",  "2.1754*eV",  "2.2143*eV", #35
		"2.2545*eV",  "2.2963*eV",  "2.3396*eV",  "2.3846*eV",  "2.4314*eV", #40
		"2.4800*eV",  "2.5306*eV",  "2.5833*eV",  "2.6383*eV",  "2.6957*eV", #45
		"2.7556*eV",  "2.8182*eV",  "2.8837*eV",  "2.9524*eV",	"3.0244*eV", #50  
		"3.1000*eV",  "3.1795*eV",  "3.2632*eV",  "3.3514*eV", "3.4444*eV",  #55 
		"3.5429*eV",  "3.6471*eV",  "3.7576*eV",  "3.8750*eV", "4.0000*eV",  #60 
		"4.1333*eV",  "4.2759*eV",  "4.4286*eV",  "4.5926*eV",  "4.7692*eV", #65  
		"4.9600*eV",  "5.1667*eV",  "5.3913*eV",  "5.6364*eV",  "5.9048*eV", #70
		"6.2000*eV" ); # 71 numbers

# Index of refraction of the pmt window
my @irefr_aerogel = (1.05054, 1.05164,1.05227, 1.05175, 1.05214, #5
		     1.05208, 1.05096, 1.0511, 1.05158, 1.05189, #10
		     1.04943, 1.052, 1.04998, 1.05114, 1.051,    #15
		     1.0522, 1.04879, 1.05137, 1.05116, 1.05164, #20
		     1.05154, 1.0492, 1.04943, 1.05081, 1.05081, #25
		     1.05058, 1.05168, 1.05071, 1.05002, 1.05125,#30
		     1.05206, 1.05162, 1.05154, 1.05052, 1.05164,#35
		     1.05154, 1.04977, 1.05121, 1.0496, 1.0496,  #40
		     1.04808,1.04899, 1.05229, 1.05208, 1.05108, #45
		     1.04947, 1.04964, 1.05208, 1.05064, 1.05062,#50
		     1.04906, 1.0502, 1.05093, 1.05098, 1.0487,  #55
		     1.0505, 1.05004, 1.0521, 1.05, 1.05058,     #60
		     1.04854, 1.05104, 1.04937, 1.04987, 1.04822,#65
		     1.04899, 1.04958, 1.05187, 1.0521, 1.04935, #70
		     1.04791, 1.04995, 1.05208, 1.05208, 1.05166,#75
		     1.04906, 1.05014, 1.05146, 1.0000, 1.0506,  #80
		     1.05104, 1.0495, 1.04983, 1.05208, 1.05208, #85
		     1.04941, 1.0505, 1.04801, 1.05206, 1.05062, #90
		     1.05041, 1.04778, 1.05083, 1.05, 1.05083,   #95
		     1.04831, 1.0491, 1.05, 1.05175); # 99 numbers

#number of iref must = the number of photon energies, and must be >2 


#( 			 1.04709, 1.0471 , 1.04712, 1.04713, 1.04715,
#		      1.04717, 1.04718, 1.0472 , 1.04722 ,1.04723,
#		      1.04725, 1.04727 ,1.04729, 1.04731 ,1.04733 ,
#		      1.04735 ,1.04737 ,1.04739 ,1.04741 ,1.04743 ,
#		      1.04746 ,1.04748 ,1.04751 ,1.04753 ,1.04756 ,
#		      1.04759 ,1.04761 ,1.04764 ,1.04768 ,1.04771 ,
#		      1.04774 ,1.04778 ,1.04781 ,1.04785 ,1.04789 ,
#		      1.04794 ,1.04798 ,1.04803 ,1.04808 ,1.04813 ,
#		      1.04819 ,1.04825 ,1.04831 ,1.04838 ,1.04845 ,
#		      1.04853 ,1.04861 ,1.0487  ,1.04879 ,1.04889 ,
#		      1.049   ,1.04912 ,1.04925 ,1.04939 ,1.04954 ,
#		      1.04971 ,1.04989 ,1.05009 ,1.05031 ,1.05056 ,
#		      1.05084 ,1.05115 ,1.0515  ,1.0519  ,1.05236 ,
#		      1.05289 ,1.0535  ,1.05422 ,1.05508 ,1.05611 ,
#		      1.05737 ) ; # 71 numbers


# Absorption coefficient for aerogel
my @abslength_aerogel = ( "44.92*cm",   "28.9562*cm",   "28.6784*cm",   "26.8925*cm",   "27.8637*cm",
			  "28.062*cm",    "27.7242*cm",   "27.1399*cm",   "26.7512*cm",   "26.2139*cm",
			  "26.0152*cm",   "25.4976*cm",   "25.0999*cm",   "24.6385*cm",   "24.2303*cm",
			  "23.7303*cm",   "23.2742*cm",   "22.696*cm",    "22.0729*cm",   "21.5874*cm",
			  "21.2631*cm",   "20.7086*cm",   "20.1605*cm",   "19.6154*cm",   "19.061*cm",
			  "18.4774*cm",   "17.8838*cm",   "17.2989*cm",   "16.6933*cm",   "16.0711*cm",
			  "15.4677*cm",   "14.8278*cm",   "14.2079*cm",   "13.5876*cm",   "12.9715*cm",
			  "12.372*cm",    "11.757*cm",    "11.1353*cm",   "10.5343*cm",   "9.94904*cm",
			  "9.45342*cm",   "9.01897*cm",   "8.3964*cm",    "7.8098*cm",    "7.32422*cm",
			  "6.91571*cm",   "6.45606*cm",   "5.98628*cm",   "5.54014*cm",   "5.11227*cm",
			  "4.69784*cm",   "4.3044*cm",    "3.93536*cm",   "3.58572*cm",   "3.24993*cm",
			  "2.93707*cm",   "2.64329*cm",   "2.36809*cm",   "2.10761*cm",   "1.86117*cm",
			  "1.62074*cm",   "1.40979*cm",   "1.21606*cm",   "1.04008*cm",   "0.887008*cm",
			  "0.753044*cm",  "0.630981*cm",  "0.516107*cm",  "0.409999*cm",  "0.314334*cm",
			  "0.242124*cm" ); #71 numbers


my @ref_aerogel;


sub define_aerogel
{

	for(my $i = 0; $i < scalar @irefr_aerogel ; $i++)
	{
		for(my $j = 0; $j < 71;$j++)
		{
			$ref_aerogel[$j] = $irefr_aerogel[$i];
		}

		my $c = $i +1;
    		# typical index of refraction of an aerogel tile
		my %mat = init_mat();
		$mat{"name"}          = "aerogel_$c";
		$mat{"description"}   = "Tile $c";
		$mat{"density"}       = "0.24";
		$mat{"ncomponents"}   = "1";
		$mat{"components"}    = "G4_CARBON_DIOXIDE 1.0";
		$mat{"photonEnergy"}      =  arrayToString(@penergy);
		$mat{"indexOfRefraction"} =  arrayToString(@ref_aerogel); #arrayToString(@irefr_aerogel); 
		$mat{"absorptionLength"}  = arrayToString(@abslength_aerogel);
		print_mat(\%configuration, \%mat);	

	}


}



define_aerogel();
build_G4();
define_bank();
define_hit();

